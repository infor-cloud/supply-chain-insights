<!DOCTYPE html>
<html>
<head>

  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="http://cdn.cloudwall.me/1.2/general.js"></script>

  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>	
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.4/js.cookie.js"></script>
  
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" >
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-json/2.6.0/jquery.json.min.js"></script>
  
  
<meta charset="ISO-8859-1">
<title> Creating a Trading Partner </title>
</head>
<style>
.take-all-space-you-can{
    width:33%;
    margin-top:1%
}
.btn-circle {
  width: 30px;
  height: 30px;
  text-align: center;
  padding: 6px 0;
  font-size: 12px;
  line-height: 1.428571429;
  border-radius: 15px;
}
</style>
<body>


<ul class="nav nav-tabs">
  <li role="presentation"class="take-all-space-you-can"><a href="./sessionProfile.html">My Profile</a></li>
  <li role="presentation"class="active take-all-space-you-can"><a href="./search.html">Trading Partners</a></li>
  <li role="presentation"class="take-all-space-you-can"><a href="./searchConnection.html">Connections</a></li>
</ul>

  <button id="goBack" class="btn btn-link">&lt;&lt;Go Back</button>

	<p> </p>
	<form id="f">
<h2 style="margin-left:1%"> Creating a Trading Partner</h2>
  <div class="col-xs-4 " id="nameBlock">
    <label for="NameLabel">&emsp;Partner Name</label>
    <input type="text" class="form-control " id="name" placeholder="Big Corporation">
   </div>
   
   
   <br><br><br>
   
   
<div class="col-xs-4 ">
    <label for="WebsiteLabel">&emsp;Website URI</label>
    <input type="text" class="form-control" id="websiteURI" placeholder="www.big.co">
    </div>
    
    
       <br><br>   <br>
       
       
<div class="col-xs-4 ">
    <label for="AddressLabel">&emsp;Address</label>
    <input type="text" class="form-control" id="streetName" placeholder="Street Name">
  </div>
</form>


<br><br><br>


<form class="form-inline">
   <div class="form-group ">
    <label class="sr-only" for="cityNameLabel">City Name</label>
    <input type="text" class="form-control" id="cityName" placeholder="City Name"style="margin-left:8%;width:188px">
  </div>
  
  <div class="form-group">
    <label class="sr-only"for="postalZoneLabel">Postal Zone</label>
    <input type="text" class="form-control" id="postalZone" placeholder="Postal Zone"style="margin-left:6%">
  </div>
  
  
  
  <br>
</form>
   <div class="col-xs-4 ">
    <label for="contactNameLabel">&emsp;Contact Name</label>
    <input type="text" class="form-control " id="contactName" placeholder="Jeffrey Doe">
   </div>
   
   <br><br><br>
   
<div class="col-xs-4 ">
    <label for="contactEmailLabel">&emsp;Contact Email</label>
    <input type="text" class="form-control" id="contactEmail" placeholder="jeffrey.doe@company.com">
    </div>
    	
       <br><br>   <br>
       
<div class="col-xs-4 ">
    <label for="contactTelephoneLabel">&emsp;Contact Telephone</label>
    <input type="text" class="form-control" id="contactTelephone" placeholder="12223334444">
</div>

	<br><br><br>
	   		
		<div id="idContainer" >
	    <label for="contactNameLabel"style="margin-left:2%">Identifier</label>
		<table class="table-bordered" style="margin-left:1%" id="idTable">	
			<thead>
				<tr>
					<th>Scheme Name</th>
					<th>  ID </th>
					<th></th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td class="schemeName">
						<div class="form-group ">
					 	   <input type="text" class="form-control" id="scheme" style="margin-top:5%;margin-bottom:5%" placeholder="Scheme Name" >
   						 </div>
					</td>
					<td class="customerID">
						<div class="form-group ">
					 	   <input type="text" class="form-control" id="id" style="margin-top:5%;margin-bottom:5%" placeholder="111-222-333" >
   						 </div>
   					 </td>
   					 <td>
   					 	<button type="button" class="btn btn-danger btn-circle delete" id="remove"><i class="glyphicon glyphicon-remove"></i></button>
   					 </td>
   				</tr>
   				<tr>
   					<td>
   						<div>
   							<button type="button" class="btn btn-default add" id="AddIDS">New Identifier</button>
   						</div>
   					</td>
   				</tr>
			</tbody>
		</table>
	</div>
  
  <br>
  <br>
  
  <button id="create" class="btn btn-primary"style="margin-left:2%; margin-bottom:3%">Create </button>


   <script type="text/javascript">
   function checkCookies(){
	   if( Cookies.get('orgName') && Cookies.get('userName') && Cookies.get('channelName'))
	   		return true
	   		
	   return false;
   }
   
   var i = 1;
   function dropdown(val, num) {
	   var y = $("#table" +n);
	   var aNode = y[0].innerHTML = val; // Append 
	 }
   
   var $table = $('#idTable');

   $('table').on('click','.delete',function(){
	   $(this).parents('tr').remove();
   });
   var idArray = [];
   var testArray = [];
   testArray[0] = "hi";
   testArray[1] = "bye"

   $('table').on('click','.add',function(){
		$('#idTable').append('<tr> <td class="schemeName"> <div class="form-group "> <input type="text" class="form-control" id="scheme" style="margin-top:5%;margin-bottom:5%" placeholder="Scheme Name" > </div> </td> <td class="customerID"> <div class="form-group "> <input type="text" class="form-control" id="id" style="margin-top:5%;margin-bottom:5%" placeholder="111-222-333" > </div> </td> <td> <button type="button" class="btn btn-danger btn-circle delete" id="remove"><i class="glyphicon glyphicon-remove"></i></button> </td> </tr> ');
		$('#idTable').append('<tr> <td> <div> <button type="button" class="btn btn-default add" id="AddIDS1">New Identifier</button> </div> </td> </tr>')
	    $(this).parents('tr').remove();
   })
   
   function ids () {
	   var rows = $('#idTable > tbody > tr')
	    rows.each(function(index){
	    	if (index < rows.length-1 && true && index >= 0) {
		    	var schemey = $(this).find(".schemeName").find("input");
		    	var idy = ($(this).find(".customerID").find("input"));
		    	idArray.push({
		             schemeName: schemey.val(), 
		           	 id: idy.val()
		         });
	    	}
	    })
   }
   
   function disableButtons() {
	   $("#goBack").prop('disabled', true);
	   $("#create").prop('disabled', true);
	   $("#btn-add").prop('disabled', true);
   }
   
   function enableButtons() {
	   $("#goBack").prop('disabled', false);
	   $("#create").prop('disabled', false);
	   $("#btn-add").prop('disabled', false);
   }
   $(function() {
	    $("#btn-add").trigger("click");
	});
   
   
   $("#goBack").click(function(){
	   location.href="./search.html"
   })
   $("#create").click(function() {
	   disableButtons()
	   if(!$("#name").val()){
			$("#error").remove();
			$('form').prepend("<p id='error'></p>")
			$("#error").prepend("Name must not be empty!" )
			$("#error").css('color','red')
		   enableButtons()
		   
	   }
	   else if(!checkCookies()){

		   location.href="./sessionProfile.html"
	   }
	   else{
		ids();
	   	$.ajax({
				type: "GET",
				url: "http://localhost:8080/fabric/create",
				dataType: "json",
				success: function(data) {
					Cookies.set('added', 'true',  {domain: '', path: ''})
					location.href="./search.html"
				},
				error : function(data) {
					$("#error").remove();
					$('form').prepend("<p id='error'></p>")
					$('#error').append(JSON.stringify (data))
					$('#error').css('color', 'red')
					enableButtons();
				},
				data: {name: 			$("#name").val(), 
					websiteURI: 		$("#websiteURI").val(),
					streetName: 		$("#streetName").val(),
					cityName: 			$("#cityName").val(),
					postalZone: 		$("#postalZone").val(),
					contactName: 		$("#contactName").val(),
					contactEmail: 		$("#contactEmail").val(),
					contactTelephone: 	$("#contactTelephone").val(),
					identifier: 		JSON.stringify(idArray),
					userName: 			Cookies.get('userName'),
					orgName: 			Cookies.get('orgName'),
					channelName: 		Cookies.get('channelName'),
					}
				})
		   	}
	   		
		});
   </script>
   
   
</body>
</html>